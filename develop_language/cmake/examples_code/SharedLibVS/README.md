# VS2015 生成动态库及使用动态库   


2017-05-25 21:51:30 蔡松豆 阅读数 3792更多
分类专栏： c++ 动态库
版权声明：本文为博主原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接和本声明.
本文链接：https://blog.csdn.net/qq_28234213/article/details/72758171
动态库（.dll）：动态库又称动态链接库英文为DLL，是Dynamic Link Library 的缩写形式，DLL是一个包含可由多个程序同时使用的代码和数据的库，DLL不是可执行文件.动态链接提供了一种方法，使进程可以调用不属于其可执行代码的函数.函数的可执行代码位于一个 DLL 中，该 DLL 包含一个或多个已被编译、链接并与使用它们的进程分开存储的函数.DLL 还有助于共享数据和资源.多个应用程序可同时访问内存中单个DLL 副本的内容.DLL 是一个包含可由多个程序同时使用的代码和数据的库.Windows下动态库为.dll后缀，在Linux在为.so后缀.（引自百度百科）

静态库（.lib）：静态库是指在我们的应用中，有一些公共代码是需要反复使用，就把这些代码编译为“库”文件；在链接步骤中，连接器将从库文件取得所需的代码，复制到生成的可执行文件中的这种库.（引自百度百科）

区别：静态库和动态库是两种共享程序代码的方式，它们的区别是：静态库在程序的链接阶段被复制到了程序中，和程序运行的时候没有关系；动态库在链接阶段没有被复制到程序中，而是程序在运行时由系统动态加载到内存中供程序调用.使用动态库的优点是系统只需载入一次动态库，不同的程序可以得到内存中相同的动态库的副本，因此节省了很多内存.

A:动态库的生成
1.新建win32项目——>DLL
这里写图片描述

这里写图片描述
2.新建头文件和源文件

// DLL_lib.cpp : 定义 DLL 应用程序的导出函数.
//

#include "stdafx.h"
#include "DLL_test.h"
int sum(int a,int b)
{
    return a + b;
}
1
2
3
4
5
6
7
8
9
10
这里写图片描述

头文件 DLL_test.h

#ifndef DLL
#define DLL
int sum(int a, int b);
#endif
1
2
3
4
这里写图片描述
3.新建source.def
(是为了在不同编译环境下都可以使用)
这里写图片描述
内容如下

LIBRAR "DLL_lib"
EXPORTS
    sum @1
1
2
3

.def 的格式是这样的

```
LIBRARY "库的名字"
EXPORTS
    函数名1 @1
    函数名2 @2
    ...
```

 
3.生成解决方案，然后就可以在Debug目录下找到生成的库

这里写图片描述

这里写图片描述

动态库的使用
（要用前面生成的库文件和建立的头文件）
新建win32项目—>控制台应用程序—>空项目
1、添加工程的头文件目录：工程—属性—配置属性—c/c++—常规—附加包含目录：加上头文件存放目录.
这里写图片描述

2、添加文件引用的lib静态库路径：工程—属性—配置属性—链接器—常规—附加库目录：加上lib文件存放目录.这里写图片描述

然后添加工程引用的lib文件名：工程—属性—配置属性—链接器—输入—附加依赖项：加上lib文件名.
这里写图片描述
3、添加工程引用的dll动态库：把引用的dll放到工程的可执行文件所在的目录下.
这里写图片描述
4.编辑代码运行

#include <iostream>
#include "DLL_test.h"
using namespace std;
int main()
{
    cout << sum(2, 4);
    getchar();
    return 0;
}
1
2
3
4
5
6
7
8
9
这里写图片描述
运行正常
这里写图片描述

